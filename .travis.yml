sudo: false

language: php

notifications:
  email:
    on_success: never
    on_failure: change

branches:
  only:
    - master
    - "/^v?[0-9](\\.[0-9])*/"

php:
  - 5.3
  - 5.6

before_script:
  - curl https://raw.githubusercontent.com/KamataRyo/travis-sctipts-collection/master/install-wp-tests.sh > ./install-wp-tests.sh
  - bash ./install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
  - npm cache clean
  - travis_retry npm install

script:
  - npm test
  - phpunit

after_success:
  - npm run generatePot
  - curl https://raw.githubusercontent.com/KamataRyo/travis-sctipts-collection/master/deploy-wp-plugin.sh | bash

env:
  matrix:
    - WP_VERSION=latest WP_MULTISITE=0
    - WP_VERSION=3.9 WP_MULTISITE=0

  global:
    - WP_VERSION_TO_DEPLOY: latest
    - PHP_VERSION_TO_DEPLOY: 5.6
    - WP_MULTISITE_TO_DEPLOY: 0
    - GH_REF: github.com/KamataRyo/inherit-theme-mods.git
    - SVN_REF: https://plugins.svn.wordpress.org/inherit-theme-mods/
    - secure: "o/R65VH5ie5xd8/UjupeyVF1H8sAVMwJxN4SXxMUvlYO7L4i5y/cy+Buehk7ixADBLje8JRFblT9nWZmbSlrVxISj7i+wEhR4DPtMMs6xLFPoVnZWeFf2/K/6dhZ2ZilT8lVj1vGtYHdzRkkhi9hnPh9A4qsjW3ZPpHFg+mtC3lMiDwccB7RgquM3P5ujKcVdKFMe56DSFZcAVqiNp5UZbKGR2ipmnXRUvly0UauexvJdqLBE5QsEWRkoroxw67205aYyGcg1IIY2WFTQSEk5Jq/mfCVLaREG6O/2vEDNvulfaBL18mrbV8bK6TrXFNhbvwcNHwi0FpU+4Go+GxjP/br+cJOhK/ARE5ISj5BcZ0+Iqy92zYuRWONAqWoHkZc2UccENgQkMsTuADKFlGPvTUuBO7FCG1tmRHhplbJ6w8R/qwG4QHicbtG2kAE8P5OX0+7VXUgUQ3wwZorFTLk9/VfzGE9E0FgiccSEv+IMpaM6HlYbyGqEa6vGCuK78tzkdH6xcEUCxJJY0msD0toQhtet7uEe0NksazPe3p1zw5Ys3SXJJpIuJTiAMk8gQEXPQJDzNE3rtsNBqW1MzcjRV9eS1ytMbnJMGn906scTvrmub8XhE2tWvT/zZRwlb1G4fcFLAn9PGAPBYJozyys2gYb9UAxESqF7oqjkH/BXbk="

matrix:
  include:
    - php: 5.6
      env: WP_VERSION=latest WP_MULTISITE=1
